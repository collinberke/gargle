<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gargle">
<title>Transition from OAuth app to OAuth client • gargle</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.6/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.6/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transition from OAuth app to OAuth client">
<meta property="og:description" content="gargle">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="gargle.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gargle</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.5.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/non-interactive-auth.html">Non-interactive auth</a>
    <a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting gargle auth</a>
    <a class="dropdown-item" href="../articles/auth-from-web.html">Auth when using R from the browser</a>
    <a class="dropdown-item" href="../articles/get-api-credentials.html">How to get your own API credentials</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/07/gargle-1-2-0/">gargle 1.2.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/08/gargle-hello-world/">gargle's debut on CRAN</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/gargle/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Transition from OAuth app to OAuth client</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/gargle/blob/HEAD/vignettes/oauth-client-not-app.Rmd" class="external-link"><code>vignettes/oauth-client-not-app.Rmd</code></a></small>
      <div class="d-none name"><code>oauth-client-not-app.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gargle.r-lib.org">gargle</a></span><span class="op">)</span></span></code></pre></div>
<p>Over the course of several releases (v1.3.0, v1.4.0, and v1.5.0),
gargle has shifted to using an OAuth <strong>client</strong> in the user
flow facilitated by <code><a href="../reference/credentials_user_oauth2.html">gargle::credentials_user_oauth2()</a></code>,
instead the previous OAuth “app”. This is a more than just a vocabulary
change (but it is also a vocabulary change). This vignette explains what
actually changed and how wrapper packages should adjust.</p>
<div class="section level2">
<h2 id="why-change-was-needed">Why change was needed<a class="anchor" aria-label="anchor" href="#why-change-was-needed"></a>
</h2>
<p>In 2022, Google partially deprecated the out-of-band (OOB) OAuth
flow. The OOB flow is used by R users who are working with Google APIs
and who use R in the browser, such as via RStudio Server, Posit
Workbench, Posit Cloud, or Google Colaboratory.</p>
<p>Conventional OOB auth <strong>still works</strong> under certain
conditions, for example, if the OAuth client is associated with a GCP
project that is in testing mode or that is internal to a Google
Workspace. But conventional OOB is no longer supported for projects that
serve external users that are in production mode. In particular, this
means that conventional OOB is no longer supported for the GCP project
that has historically made auth “just work” for casual users of packages
such as googledrive, googlesheets4, and bigrquery. The default OAuth
client used by these package no longer works with conventional OOB.</p>
<p>In response, as of v1.3.0, gargle implements a new variant of OOB,
called <strong>pseudo-OOB</strong>, to continue to provide a
user-friendly auth flow for googledrive/googlesheets4/bigrquery on
RStudio Server/Posit Workbench/Posit Cloud/Google Colaboratory. The
pseudo-OOB flow is also available for other developers to use. This flow
is triggered when <code>use_oob = TRUE</code> (an existing convention in
gargle and gargle-using packages) <strong>and</strong> the configured
OAuth client is of the <em>web</em> type (when creating an OAuth client,
this is called the “Web application” type).</p>
<style>
  table {
    border-collapse: collapse;
    border-style: none;
  }
  
  .empty-cell {
    border: none;
    background-color: transparent;
  }
  
  table thead {
    background-color: transparent;
  }
  
  table th, table td {
    border-style: solid;
  }
</style>
<table class="table">
<thead>
<tr>
<th class="empty-cell"></th>
      <th class="empty-cell"></th>
      <th colspan="2"><verb>use_oob</verb></th>
    </tr>
<tr>
<th class="empty-cell"></th>
      <th class="empty-cell"></th>
      <th>FALSE</th>
      <th>TRUE</th>
    </tr>
</thead>
<tbody>
<tr>
<th rowspan="2">client type</th>
      <th>installed</th>
      <td>use httpuv to spin up<br> a temporary web server</td>
      <td>conventional OOB</td>
    </tr>
<tr>
<th>web</th>
      <td>--not possible--</td>
      <td>pseudo-OOB</td>
    </tr>
</tbody>
</table>
<p>In the past, gargle basically assumed that every OAuth client was of
the <em>installed</em> type (when creating an OAuth client, this is
called the “Desktop app” type). Therefore, the introduction of
pseudo-OOB meant that gargle had to learn about different OAuth client
types (web vs. installed). And that didn’t play well with
<code><a href="https://httr.r-lib.org/reference/oauth_app.html" class="external-link">httr::oauth_app()</a></code>, which gargle had been using to store the
client ID and secret.</p>
<p>That’s why there is a new S3 class,
<code>"gargle_oauth_client"</code>, with a constructor of the same name.
Since more information is now necessary to instantiate a client
(e.g. its type and, potentially, redirect URIs), the recommended way to
create a client is to provide JSON downloaded from the GCP console to
<code><a href="../reference/gargle_oauth_client_from_json.html">gargle_oauth_client_from_json()</a></code>.</p>
<p>Since we had to introduce a new S3 class and supporting functions, we
also took this chance to make the vocabulary pivot from “OAuth app” to
“OAuth client”. Google’s documentation has always talked about the
“OAuth client”, so this is more natural. This vocabulary is also more
future-facing, anticipating the day when gargle might shift from httr to
httr2, which uses <code>httr2:oauth_client()</code>. As a bridging
measure, the <code>"gargle_oauth_client"</code> class currently inherits
from httr’s <code>"oauth_app"</code>, but this probably won’t be true in
the long-term.</p>
<div class="section level3">
<h3 id="how-to-instantiate-an-oauth-client-in-r">How to instantiate an OAuth client in R<a class="anchor" aria-label="anchor" href="#how-to-instantiate-an-oauth-client-in-r"></a>
</h3>
<p>If you do auth via gargle, here are some recommended changes:</p>
<ol style="list-style-type: decimal">
<li>Stop using <code><a href="https://httr.r-lib.org/reference/oauth_app.html" class="external-link">httr::oauth_app()</a></code> or
<code><a href="../reference/oauth_app_from_json.html">gargle::oauth_app_from_json()</a></code> to instantiate an OAuth
client.</li>
<li>Start using <code><a href="../reference/gargle_oauth_client_from_json.html">gargle_oauth_client_from_json()</a></code> (strongly
recommended) or <code><a href="../reference/gargle_oauth_client_from_json.html">gargle_oauth_client()</a></code> instead.</li>
</ol>
<p>This advice applies to anything you do inside your package and also
to what you encourage and document for your users.</p>
<p>gargle ships with JSON files for two non-functional OAuth clients,
just to make this all more concrete:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">path_to_installed_client</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"extdata"</span>, <span class="st">"client_secret_installed.googleusercontent.com.json"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"gargle"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/gargle/extdata/client_secret_installed.googleusercontent.com.json"</span></span>
<span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/prettify.html" class="external-link">prettify</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scan.html" class="external-link">scan</a></span><span class="op">(</span><span class="va">path_to_installed_client</span>, what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     "installed": {</span></span>
<span><span class="co">#&gt;         "client_id": "abc.apps.googleusercontent.com",</span></span>
<span><span class="co">#&gt;         "project_id": "a_project",</span></span>
<span><span class="co">#&gt;         "auth_uri": "https://accounts.google.com/o/oauth2/auth",</span></span>
<span><span class="co">#&gt;         "token_uri": "https://accounts.google.com/o/oauth2/token",</span></span>
<span><span class="co">#&gt;         "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",</span></span>
<span><span class="co">#&gt;         "client_secret": "ssshh-i-am-a-secret",</span></span>
<span><span class="co">#&gt;         "redirect_uris": [</span></span>
<span><span class="co">#&gt;             "http://localhost"</span></span>
<span><span class="co">#&gt;         ]</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="op">(</span><span class="va">client</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gargle_oauth_client_from_json.html">gargle_oauth_client_from_json</a></span><span class="op">(</span><span class="va">path_to_installed_client</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">&lt;gargle_oauth_client&gt;</span></span></span>
<span><span class="co">#&gt; name: a_project_d1c5a8066d2cbe48e8d94514dd286163</span></span>
<span><span class="co">#&gt; id: abc.apps.googleusercontent.com</span></span>
<span><span class="co">#&gt; secret: <span style="color: #555555;">&lt;REDACTED&gt;</span></span></span>
<span><span class="co">#&gt; type: installed</span></span>
<span><span class="co">#&gt; redirect_uris: http://localhost</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">client</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "gargle_oauth_client" "oauth_app"</span></span>
<span></span>
<span><span class="op">(</span><span class="va">path_to_web_client</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"extdata"</span>, <span class="st">"client_secret_web.googleusercontent.com.json"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"gargle"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/gargle/extdata/client_secret_web.googleusercontent.com.json"</span></span>
<span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/prettify.html" class="external-link">prettify</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scan.html" class="external-link">scan</a></span><span class="op">(</span><span class="va">path_to_web_client</span>, what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     "web": {</span></span>
<span><span class="co">#&gt;         "client_id": "abc.apps.googleusercontent.com",</span></span>
<span><span class="co">#&gt;         "project_id": "a_project",</span></span>
<span><span class="co">#&gt;         "auth_uri": "https://accounts.google.com/o/oauth2/auth",</span></span>
<span><span class="co">#&gt;         "token_uri": "https://accounts.google.com/o/oauth2/token",</span></span>
<span><span class="co">#&gt;         "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",</span></span>
<span><span class="co">#&gt;         "client_secret": "ssshh-i-am-a-secret",</span></span>
<span><span class="co">#&gt;         "redirect_uris": [</span></span>
<span><span class="co">#&gt;             "https://www.tidyverse.org/google-callback/"</span></span>
<span><span class="co">#&gt;         ]</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="op">(</span><span class="va">client</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gargle_oauth_client_from_json.html">gargle_oauth_client_from_json</a></span><span class="op">(</span><span class="va">path_to_web_client</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">&lt;gargle_oauth_client&gt;</span></span></span>
<span><span class="co">#&gt; name: a_project_d1c5a8066d2cbe48e8d94514dd286163</span></span>
<span><span class="co">#&gt; id: abc.apps.googleusercontent.com</span></span>
<span><span class="co">#&gt; secret: <span style="color: #555555;">&lt;REDACTED&gt;</span></span></span>
<span><span class="co">#&gt; type: web</span></span>
<span><span class="co">#&gt; redirect_uris: https://www.tidyverse.org/google-callback/</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">client</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "gargle_oauth_client" "oauth_app"</span></span></code></pre></div>
<p>Notice the difference in the JSON for the installed vs. web client.
Note the class of the <code>client</code> object, the new
<code>type</code> field, and the <code>redirect_uris</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="authstate-class">
<code>AuthState</code> class<a class="anchor" aria-label="anchor" href="#authstate-class"></a>
</h2>
<p>There are two gargle classes that are impacted by the
OAuth-app-to-client switch: <code>AuthState</code> and
<code>Gargle2.0</code>. We cover <code>AuthState</code> here and
<code>Gargle2.0</code> in the next section.</p>
<p>If a wrapper package follows the design laid out in
<code><a href="../articles/gargle-auth-in-client-package.html">vignette("gargle-auth-in-client-package")</a></code>, it will use an
instance of <code>AuthState</code> to manage the package’s auth state.
Let’s assume that internal object is named <code>.auth</code>, which it
usually is. Here are the changes you need to know about in
<code>AuthState</code>:</p>
<ul>
<li>The <code>app</code> field is deprecated, in favor of a new field
<code>client</code>. If you request <code>.auth$app</code>, there will
be a deprecation message and the <code>client</code> field is
returned.</li>
<li>The <code>$set_app()</code> method is deprecated, in favor of a new
<code>$set_client()</code> method. If you call
<code>.auth$set_app()</code>, there will be a deprecation message and
the input is used, instead, to set the <code>client</code> field.</li>
<li>The <code>app</code> argument of the <code><a href="../reference/init_AuthState.html">init_AuthState()</a></code>
constructor is deprecated in favor of the new <code>client</code>
argument. If you call <code>init_AuthState(app = x)</code>, there will
be a deprecation message and the input <code>x</code> is used as the
<code>client</code> argument instead.</li>
</ul>
<p>Here are the changes you probably need to make in your package:</p>
<ul>
<li>The first argument of the user-facing function,
<code>PKG_auth_configure()</code>, should become <code>client</code>
(which is new). Move the existing <code>app</code> argument to the last
position and deprecate it.</li>
<li>Deprecate <code>PKG_oauth_app()</code> (the function to reveal the
user’s configured OAuth client).</li>
<li>Introduce <code>PKG_oauth_client()</code> to replace
<code>PKG_oauth_app()</code>.</li>
</ul>
<p>Here’s how <code>googledrive::drive_auth_configure()</code> and
<code>googledrive::drive_oauth_client()</code> looked before and after
the transition:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># BEFORE</span></span>
<span><span class="va">drive_auth_configure</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">app</span>, <span class="va">path</span>, <span class="va">api_key</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># not showing this code</span></span>
<span>  <span class="va">.auth</span><span class="op">$</span><span class="fu">set_app</span><span class="op">(</span><span class="va">app</span><span class="op">)</span></span>
<span>  <span class="co"># more code we're not showing</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">drive_oauth_app</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">.auth</span><span class="op">$</span><span class="va">app</span></span>
<span></span>
<span><span class="co"># AFTER</span></span>
<span><span class="va">drive_auth_configure</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">client</span>, <span class="va">path</span>, <span class="va">api_key</span>, <span class="va">app</span> <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html" class="external-link">is_present</a></span><span class="op">(</span><span class="va">app</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecate_soft.html" class="external-link">deprecate_warn</a></span><span class="op">(</span></span>
<span>      <span class="st">"2.1.0"</span>,</span>
<span>      <span class="st">"drive_auth_configure(app)"</span>,</span>
<span>      <span class="st">"drive_auth_configure(client)"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu">drive_auth_configure</span><span class="op">(</span>client <span class="op">=</span> <span class="va">app</span>, path <span class="op">=</span> <span class="va">path</span>, api_key <span class="op">=</span> <span class="va">api_key</span><span class="op">)</span></span>
<span>  <span class="op">}</span> </span>
<span>  </span>
<span>  <span class="co"># not showing this code</span></span>
<span>  <span class="va">.auth</span><span class="op">$</span><span class="fu">set_client</span><span class="op">(</span><span class="va">client</span><span class="op">)</span></span>
<span>  <span class="co"># more code we're not showing</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">drive_oauth_client</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">.auth</span><span class="op">$</span><span class="va">client</span></span>
<span></span>
<span><span class="va">drive_oauth_app</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecate_soft.html" class="external-link">deprecate_warn</a></span><span class="op">(</span></span>
<span>    <span class="st">"2.1.0"</span>, <span class="st">"drive_oauth_app()"</span>, <span class="st">"drive_oauth_client()"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">drive_oauth_client</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The approach above follows various conventions explained in
<code><a href="https://lifecycle.r-lib.org/articles/communicate.html" class="external-link">vignette("communicate", package = "lifecycle")</a></code>. If you also
choose to use the lifecycle package to assist in this process,
<code>usethis::use_lifecycle()</code> function does some helpful
one-time setup in your package:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_lifecycle</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The roxygen documentation helpers in gargle assume
<code>PKG_auth_configure()</code> is adapted as shown above:</p>
<ul>
<li>
<code>PREFIX_auth_configure_description()</code> crosslinks to
<code>PREFIX_oauth_client()</code> now, not
<code>PREFIX_oauth_app()</code>.</li>
<li>
<code>PREFIX_auth_configure_params()</code> documents the
<code>client</code> argument</li>
<li>
<code>PREFIX_auth_configure_params()</code> uses a lifecycle badge
and text to communicate that <code>app</code> is deprecated.</li>
<li>
<code>PREFIX_auth_configure_params()</code> crosslinks to
<code><a href="../reference/gargle_oauth_client_from_json.html">gargle::gargle_oauth_client_from_json()</a></code> which requires
gargle (&gt;= 1.3.0)</li>
</ul>
</div>
<div class="section level2">
<h2 id="gargle2-0-class">
<code>Gargle2.0</code> class<a class="anchor" aria-label="anchor" href="#gargle2-0-class"></a>
</h2>
<p><code>Gargle2.0</code> is the second gargle class that is impacted by
the OAuth-app-to-client switch.</p>
<p>Here are the changes you probably need to make in your package:</p>
<ul>
<li>
<p>Inside <code>PKG_auth()</code>, you presumably call
<code><a href="../reference/token_fetch.html">gargle::token_fetch()</a></code>. If you are passing
<code>app = &lt;SOMETHING&gt;</code>, change that to
<code>client = &lt;SOMETHING&gt;</code>. Neither <code>app</code> nor
<code>client</code> are formal arguments of
<code><a href="../reference/token_fetch.html">gargle::token_fetch()</a></code>, instead, these are intended for
eventual use by <code><a href="../reference/credentials_user_oauth2.html">gargle::credentials_user_oauth2()</a></code>. Here’s a
sketch of how this looks in <code>googledrive::drive_auth()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>drive_auth <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># code not shown</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  cred <span class="ot">&lt;-</span> gargle<span class="sc">::</span><span class="fu">token_fetch</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">scopes =</span> scopes,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># app = drive_oauth_client() %||% &lt;BUILT_IN_DEFAULT_CLIENT&gt;,   # BEFORE</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">client =</span> <span class="fu">drive_oauth_client</span>() <span class="sc">%||%</span> <span class="er">&lt;</span>BUILT_IN_DEFAULT_CLIENT<span class="sc">&gt;</span>,  <span class="co"># AFTER</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">email =</span> email,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> path,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">package =</span> <span class="st">"googledrive"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cache =</span> cache,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_oob =</span> use_oob,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">token =</span> token</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># code not shown</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</li>
<li><p>If you ever call <code><a href="../reference/credentials_user_oauth2.html">gargle::credentials_user_oauth2()</a></code>
directly, use the new <code>client</code> argument instead of the
deprecated <code>app</code> argument.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://jennybryan.org" class="external-link">Jennifer Bryan</a>, Craig Citro, <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer>
</body>
</html>
